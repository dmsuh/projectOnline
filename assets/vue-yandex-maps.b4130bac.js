import{d as y,r as Y,c as w,s as j,p as S,o as f,n as I,w as V,a as P,h as p,i as b,g as R,e as D}from"./index.c807f480.js";function T(e){return typeof window=="undefined"?{value:e,__v_isRef:!0}:Y(e)}function A(e,n){return typeof window=="undefined"?{get value(){return e()},__v_isRef:!0}:w(e,n)}function $(){R()||_({text:"injectMap must be only called on runtime.",isInternal:!0});const e=b("map");return(!e||!D(e))&&_({text:"Was not able to inject valid map in injectMap.",isInternal:!0}),e}function z(){R()||_({text:"injectLayers must be only called on runtime.",isInternal:!0});const e=b("layers");return(!e||!D(e))&&_({text:"Was not able to inject valid layers in injectLayers.",isInternal:!0}),e}function H(){return typeof window=="undefined"&&_({text:"waitTillYmapInit cannot be called on SSR.",isInternal:!0}),new Promise((e,n)=>{if(typeof ymaps3!="undefined"){const u=setTimeout(()=>{n(new c.YandexMapException("Was not able to wait for map initialization in waitTillYmapInit. Ensure that map was initialized."))},5e3);V(c.isLoaded,()=>{clearTimeout(u),c.loadStatus.value==="loaded"?e():n(c.loadError)},{immediate:!0})}else e()})}function q(e){!e&&!R()&&_({text:"onMapInit must be only called on runtime.",isInternal:!0}),typeof window=="undefined"&&_({text:"waitTillMapInit cannot be called on SSR.",isInternal:!0});const n=e||$();return new Promise((u,t)=>{const a=setTimeout(()=>{n.value||t(new c.YandexMapException("Was not able to wait for map initialization in waitTillMapInit."))},5e3);let l;l=V(n,()=>{n.value&&(l==null||l(),clearTimeout(a),u())},{immediate:!0})})}async function g({returnOnly:e,strictMapRoot:n,requiredImport:u,createFunction:t,settings:a,isLayer:l,isMapRoot:m,mapRootRef:v}){R()||_({text:"setupMapChildren must be only called on runtime.",isInternal:!0});const i=j(),o=b("mapRoot",null),s=b("mapRootInitPromises",null);let r;const h=$(),O=z();m&&(S("mapRoot",v||i),r=j([]),S("mapRootInitPromises",r)),e||P(()=>{var d;i.value&&!("toWorldCoordinates"in i.value)&&(typeof(o==null?void 0:o.value)=="object"&&Array.isArray(o.value)?o.value=o.value.filter(M=>M!==i.value):(d=(o==null?void 0:o.value)||h.value)==null||d.removeChild(i.value))}),a&&V(a,d=>{i.value&&"update"in i.value&&i.value.update(d!=null?d:{})},{deep:!0}),l?await H():(await q(),h.value||_({text:"map is undefined in setupMapChildren.",isInternal:!0})),n&&(o!=null&&o.value||await I(),o!=null&&o.value||_({text:"mapRoot is undefined in setupMapChildren.",isInternal:!0})),m&&(await I(),await Promise.all((r==null?void 0:r.value)||[]));let C;if(u){const d=u();s!=null&&s.value&&s.value.push(Promise.resolve(d)),C=await d}return i.value=t(C),!e&&h.value&&!("toWorldCoordinates"in i.value)?typeof(o==null?void 0:o.value)=="object"&&Array.isArray(o.value)?o.value=[...o.value,i.value]:((o==null?void 0:o.value)||h.value).addChild(i.value):l&&O.value.push(i.value),i.value}function B(){var e;return typeof process!="undefined"&&(((e=process.env)==null?void 0:e.NODE_ENV)==="development"||process.dev)}function _({text:e,isInternal:n}){throw n&&(e+=" This is likely Vue Yandex Maps internal bug.",B()&&(e+=" You can report this bug here: https://github.com/PNKBizz/vue-yandex-maps/issues/new/choose")),new c.YandexMapException(e)}var c;(e=>{e.settings=T({apikey:""}),e.ymaps=()=>ymaps3;class n extends Error{constructor(t){super(t),this.message=t,this.name="YandexMapException"}}e.YandexMapException=n,e.loadStatus=T("pending"),e.isLoaded=A(()=>e.loadStatus.value==="loaded"||e.loadStatus.value==="error"),e.loadError=T(null)})(c||(c={}));const N=c.YandexMapException,L={apikey:!0,lang:!0,initializeOn:!0,importModules:!0,version:!0,strictMode:!0};function W(){return new Promise((e,n)=>{if(typeof ymaps3!="undefined")return e();if(typeof window=="undefined")return n(new N("You must call initYmaps on Client Side only"));if(document.getElementById("vue-yandex-maps")){const l=V(c.loadStatus,m=>{!c.isLoaded.value||(l(),m==="error"&&n(c.loadError),m==="loaded"&&e())},{immediate:!0});return}c.loadStatus.value="loading";const u=c.settings.value,t=document.createElement("SCRIPT"),a=new URL(`https://api-maps.yandex.ru/${u.version}/`);a.searchParams.set("lang",u.lang||"ru_RU"),a.searchParams.set("apikey",u.apikey),t.setAttribute("src",a.toString()),t.setAttribute("async",""),t.setAttribute("defer",""),t.setAttribute("type","text/javascript"),t.setAttribute("id","vue-yandex-maps"),document.head.appendChild(t),t.onload=async()=>{try{await c.ymaps().ready,u.strictMode&&(c.ymaps().strictMode=!0),u.importModules&&await Promise.all(u.importModules.map(l=>c.ymaps().import(l))),c.loadStatus.value="loaded",e()}catch(l){c.loadStatus.value="error",c.loadError.value=l,n(l)}},t.onerror=l=>{c.loadError.value=l,n(l)}})}function G(e){const n={lang:"ru_RU",initializeOn:"onComponentMount",importModules:[],version:"3.0",strictMode:!1,...e};n.apikey||_({text:"You must specify apikey for createYmapsOptions"});const u=Object.keys(n).filter(t=>!(t in L));return u.length&&_({text:`You have passed unknown keys to createYmapsOptions: ${u.join(", ")}. Only ${Object.keys(L).join(", ")} are allowed.`}),c.settings.value=n,n}function J(e){return{install(n){G(e)}}}const K=y({name:"YandexMap",props:{modelValue:{type:Object,default:null},value:{type:Object,default:null},tag:{type:String,default:"div"},width:{type:String,default:"100%"},height:{type:String,default:"100%"},settings:{type:Object,validator:e=>"location"in e,required:!0},layers:{type:Array,default:()=>[]}},emits:{input(e){return!e||typeof ymaps3=="undefined"||e instanceof ymaps3.YMap},"update:modelValue"(e){return!e||typeof ymaps3=="undefined"||e instanceof ymaps3.YMap}},setup(e,{slots:n,emit:u}){const t=j(null),a=j([]),l=j(null),m=Y(null),v=j(!1),i=Y(0);S("map",t),S("layers",a),S("projection",l),S("needsToHold",i),u("input",t.value),u("update:modelValue",t.value);const o=async()=>{const s=m.value;s||_({text:"<yandex-map> container is undefined after component mount.",isInternal:!0}),t.value&&t.value.destroy();const r={...e.settings};l.value&&!r.projection&&(r.projection=l.value);const h=new ymaps3.YMap(s,r,[...a.value,...e.layers]);t.value=h,u("input",t.value),u("update:modelValue",t.value)};return f(async()=>{if(!c.isLoaded.value)if(c.settings.value.initializeOn==="onComponentMount")try{await W()}catch(s){console.error("An error occured while initializing Yandex Map with onComponentMount setting"),console.error(s);return}else _({text:"You have set up <yandex-map> component without initializing Yandex maps. Please check initializeOn setting or call initYmaps manually before registering this component."});v.value=!0,await I(),i.value&&await new Promise(s=>V(i,()=>{i.value||s()},{immediate:!0})),await o()}),P(()=>{t.value=null,u("input",t.value),u("update:modelValue",t.value)}),()=>{var s;const r=p("div",{class:"__ymap_container",style:{width:"100%",height:"100%"},ref:m});return v.value?p(e.tag,{class:"__ymap",style:{width:e.width,height:e.height}},[r,p("div",{class:"__ymap_slots",style:{display:"none"}},(s=n.default)==null?void 0:s.call(n))]):r}}}),Z=y({name:"YandexMapListener",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){let t;return f(async()=>{t=await g({createFunction:()=>new ymaps3.YMapListener(e.settings||{}),settings:w(()=>e.settings)}),u("input",t),u("update:modelValue",t)}),()=>{var a;return p("div",(a=n.default)==null?void 0:a.call(n))}}}),Q=y({name:"YandexMapDefaultFeaturesLayer",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0},hold(e){return!0}},setup(e,{slots:n,emit:u}){const t=b("needsToHold");t.value++;let a;return f(async()=>{a=await g({createFunction:()=>new ymaps3.YMapDefaultFeaturesLayer(e.settings||{}),settings:w(()=>e.settings),isLayer:!0}),u("input",a),u("update:modelValue",a),t.value--}),()=>{var l;return p("div",(l=n.default)==null?void 0:l.call(n))}}}),X=y({name:"YandexMapDefaultSchemeLayer",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0},hold(e){return!0}},setup(e,{slots:n,emit:u}){const t=b("needsToHold");t.value++;let a;return f(async()=>{a=await g({createFunction:()=>new ymaps3.YMapDefaultSchemeLayer(e.settings||{}),settings:w(()=>e.settings),isLayer:!0}),u("input",a),u("update:modelValue",a),t.value--}),()=>{var l;return p("div",(l=n.default)==null?void 0:l.call(n))}}});y({name:"YandexMapTileDataSource",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0},hold(e){return!0}},setup(e,{slots:n,emit:u}){const t=b("needsToHold");t.value++;let a;return f(async()=>{a=await g({createFunction:()=>new ymaps3.YMapTileDataSource(e.settings),settings:w(()=>e.settings),isLayer:!0}),u("input",a),u("update:modelValue",a),t.value--}),()=>{var l;return p("div",(l=n.default)==null?void 0:l.call(n))}}});y({name:"YandexMapFeatureDataSource",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0},hold(e){return!0}},setup(e,{slots:n,emit:u}){const t=b("needsToHold");t.value++;let a;return f(async()=>{a=await g({createFunction:()=>new ymaps3.YMapFeatureDataSource(e.settings),settings:w(()=>e.settings),isLayer:!0}),u("input",a),u("update:modelValue",a),t.value--}),()=>{var l;return p("div",(l=n.default)==null?void 0:l.call(n))}}});y({name:"YandexMapLayer",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0},hold(e){return!0}},setup(e,{slots:n,emit:u}){const t=b("needsToHold");t.value++;let a;return f(async()=>{a=await g({createFunction:()=>new ymaps3.YMapLayer(e.settings||{}),settings:w(()=>e.settings),isLayer:!0}),u("input",a),u("update:modelValue",a),t.value--}),()=>{var l;return p("div",(l=n.default)==null?void 0:l.call(n))}}});const ee=y({name:"YandexMapMarker",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){let t;const a=Y(null);return f(async()=>{t=await g({settings:w(()=>e.settings),createFunction:()=>new ymaps3.YMapMarker(e.settings,a.value)}),u("input",t),u("update:modelValue",t)}),()=>{var l;return p("div",{ref:a},(l=n.default)==null?void 0:l.call(n))}}}),te=y({name:"YandexMapDefaultMarker",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){let t;const a=Y(null),l=Y(()=>{}),m=w(()=>{const v={...e.settings};return v.popup&&(typeof v.popup.content=="undefined"||v.popup.content==="fromSlot")&&a.value&&(v.popup={...v.popup,content:i=>(l.value=i,a.value)}),v});return f(async()=>{t=await g({createFunction:({YMapDefaultMarker:v})=>new v(m.value),requiredImport:()=>ymaps3.import("@yandex/ymaps3-markers@0.0.1"),settings:m}),u("input",t),u("update:modelValue",t)}),()=>{var v;return p("div",{ref:a},(v=n.popup)==null?void 0:v.call(n,{close:l.value}))}}});y({name:"YandexMapFeature",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){let t;return f(async()=>{t=await g({createFunction:()=>new ymaps3.YMapFeature(e.settings),settings:w(()=>e.settings)}),u("input",t),u("update:modelValue",t)}),()=>{var a;return p("div",(a=n.default)==null?void 0:a.call(n))}}});const ae=y({name:"YandexMapControls",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){const t=j(null);return f(async()=>{t.value=await g({createFunction:()=>new ymaps3.YMapControls(e.settings),isMapRoot:!0,settings:w(()=>e.settings)}),u("input",t.value),u("update:modelValue",t.value)}),()=>{var a;return t.value?p("div",(a=n.default)==null?void 0:a.call(n)):p("div")}}});y({name:"YandexMapControl",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){let t;return f(async()=>{t=await g({createFunction:()=>new ymaps3.YMapControl(e.settings),settings:w(()=>e.settings),strictMapRoot:!0}),u("input",t),u("update:modelValue",t)}),()=>{var a;return p("div",(a=n.default)==null?void 0:a.call(n))}}});y({name:"YandexMapControlButton",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){let t;return f(async()=>{t=await g({createFunction:()=>new ymaps3.YMapControlButton(e.settings),settings:w(()=>e.settings),strictMapRoot:!0}),u("input",t),u("update:modelValue",t)}),()=>{var a;return p("div",(a=n.default)==null?void 0:a.call(n))}}});const ne=y({name:"YandexMapGeolocationControl",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){let t;return f(async()=>{t=await g({createFunction:a=>new a.YMapGeolocationControl(e.settings),requiredImport:()=>ymaps3.import("@yandex/ymaps3-controls@0.0.1"),settings:w(()=>e.settings),strictMapRoot:!0}),u("input",t),u("update:modelValue",t)}),()=>{var a;return p("div",(a=n.default)==null?void 0:a.call(n))}}}),ue=y({name:"YandexMapZoomControl",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){let t;return f(async()=>{t=await g({createFunction:a=>new a.YMapZoomControl(e.settings),requiredImport:()=>ymaps3.import("@yandex/ymaps3-controls@0.0.1"),settings:w(()=>e.settings),strictMapRoot:!0}),u("input",t),u("update:modelValue",t)}),()=>{var a;return p("div",(a=n.default)==null?void 0:a.call(n))}}});y({name:"YandexMapCartesianProjection",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},bounds:{type:Array,required:!0},cycled:{type:Array}},emits:{input(e){return!0},"update:modelValue"(e){return!0},hold(e){return!0}},setup(e,{slots:n,emit:u}){const t=b("needsToHold");t.value++;const a=b("projection");return f(async()=>{if(!a)return;const l=await g({returnOnly:!0,createFunction:({Cartesian:m})=>new m(e.bounds,e.cycled),requiredImport:()=>ymaps3.import("@yandex/ymaps3-cartesian-projection@0.0.1")});a.value=l,u("input",l),u("update:modelValue",l),t.value--}),()=>{var l;return p("div",(l=n.default)==null?void 0:l.call(n))}}});y({name:"YandexMapSphericalMercatorProjection",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null}},emits:{input(e){return!0},"update:modelValue"(e){return!0},hold(e){return!0}},setup(e,{slots:n,emit:u}){const t=b("needsToHold");t.value++;const a=b("projection");return f(async()=>{if(!a)return;const l=await g({returnOnly:!0,createFunction:({SphericalMercator:m})=>new m,requiredImport:()=>ymaps3.import("@yandex/ymaps3-spherical-mercator-projection@0.0.1")});a.value=l,u("input",l),u("update:modelValue",l),t.value--}),()=>{var l;return p("div",(l=n.default)==null?void 0:l.call(n))}}});const le=y({name:"YandexMapHint",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},hintProperty:{type:String,required:!0}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){let t;const a=j(null),l=j("");return f(async()=>{await g({createFunction:({YMapHint:m,YMapHintContext:v})=>{t=new m({hint:o=>{var s;return(s=o==null?void 0:o.properties)==null?void 0:s[e.hintProperty]}});class i extends ymaps3.YMapEntity{_onAttach(){const s=this;s._element=a.value,s._detachDom=ymaps3.useDomContext(s,s._element,null),s._watchContext(v,()=>{var r;l.value=(r=s._consumeContext(v))==null?void 0:r[e.hintProperty]},{immediate:!0})}_onDetach(){this._detachDom()}}return t.addChild(new i({})),t},requiredImport:()=>ymaps3.import("@yandex/ymaps3-hint@0.0.1")}),u("input",t),u("update:modelValue",t)}),()=>{var m;return p("div",{ref:a},(m=n.default)==null?void 0:m.call(n,{content:l.value}))}}}),re=y({name:"YandexMapOpenMapsButton",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){let t;return f(async()=>{t=await g({createFunction:({YMapOpenMapsButton:a})=>new a(e.settings),requiredImport:()=>ymaps3.import("@yandex/ymaps3-controls-extra"),settings:w(()=>e.settings),strictMapRoot:!0}),u("input",t),u("update:modelValue",t)}),()=>{var a;return p("div",(a=n.default)==null?void 0:a.call(n))}}}),ie=y({name:"YandexMapClusterer",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})},gridSize:{type:Number,default:64}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){let t=!1;const a=j(null),l=j([]),m=Y([]),v=Y([]);let i;const o=w(()=>{var r;return(r=e.settings.tickTimeout)!=null?r:200}),s=w(()=>{const r={...e.settings};!r.method&&i&&(r.method=i==null?void 0:i({gridSize:e.gridSize})),r.tickTimeout=o.value;const h=d=>{const M=l.value.filter(x=>x._props.coordinates[0]===d.geometry.coordinates[0]&&x._props.coordinates[1]===d.geometry.coordinates[1]);return M.length>1&&_({text:`More than one entities with coordinates of ${d.geometry.coordinates.join(", ")} were found in YandexMapClusterer, which is not allowed`}),M.length||_({text:`No entity with coordinates of ${d.geometry.coordinates.join(", ")} were found in YandexMapClusterer.`,isInternal:!0}),M[0]},O=d=>{const M=v.value.find(x=>x&&x.getAttribute("coordinates")===JSON.stringify(d));return new ymaps3.YMapMarker({coordinates:d},M||document.createElement("span"))},C=l.value.map((d,M)=>({type:"Feature",id:Math.random().toString(),geometry:{type:"Point",coordinates:d._props.coordinates},properties:"properties"in d._props?d._props.properties:{}}));return r.onRender=d=>{if(m.value=d,t?t=!1:I(()=>{var M,x,k,E;t=!0;for(const F of Object.keys(((M=a.value)==null?void 0:M._entitiesCache)||{}))F.startsWith("cluster")&&((x=a.value)==null||delete x._entitiesCache[F],(k=a.value)==null||delete k._visibleEntities[F]);(E=a.value)==null||E._render()}),e.settings.onRender)return e.settings.onRender(d)},{...r,marker:h,features:C,cluster:O}});return V(()=>e.settings,async()=>{var r,h;await I(),(r=a.value)==null||r.update(s.value),(h=a.value)==null||h._render()},{deep:!0}),V(l,async()=>{var r,h;await I(),(r=a.value)==null||r.update(s.value),(h=a.value)==null||h._render(),setTimeout(()=>{var O;return(O=a.value)==null?void 0:O._render()},o.value)}),f(async()=>{a.value=await g({createFunction:({YMapClusterer:r,clusterByGrid:h})=>(i=h,new r(s.value)),requiredImport:()=>ymaps3.import("@yandex/ymaps3-clusterer@0.0.1"),isMapRoot:!0,mapRootRef:l}),u("input",a.value),u("update:modelValue",a.value)}),()=>{var r;if(!a.value)return p("div");const h=m.value.map((O,C)=>{var d;return p("div",{ref:M=>{v.value[C]=M},attrs:{coordinates:JSON.stringify(O.lnglat)},coordinates:JSON.stringify(O.lnglat)},(d=n.cluster)==null?void 0:d.call(n,{clustererObject:O,length:O.features.length}))});return p("div",[...((r=n.default)==null?void 0:r.call(n))||[],...h])}}}),oe=y({name:"YandexMapCollection",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:u}){const t=j(null);return f(async()=>{t.value=await g({createFunction:()=>new ymaps3.YMapCollection({}),isMapRoot:!0}),u("input",t.value),u("update:modelValue",t.value)}),()=>{var a;return t.value?p("div",(a=n.default)==null?void 0:a.call(n)):p("div")}}});export{ee as _,te as a,X as b,J as c,Q as d,Z as e,K as f,ae as g,ne as h,ue as i,le as j,re as k,ie as l,oe as m};
